# 主域名收集



## 1.ICP备案查询

### 1.1 什么是ICP备案

ICP备案是指网站在信息产业部提交网站信息进行官方认可。对国内各大小网站（包括企业及个人站点）的严格审查工作，对于没有合法备案的非经营性网站或没有取得ICP许可证的经营性网站，根据网站性质，将予以罚款，严重的关闭网站，以此规范网络安全，打击一切利用网络资源进行不法活动的犯罪行为。也就是说，只要是盈利为目的的网站，都要进行ICP备案，否则会受到相应的处罚。

**国内使用国内服务器的网站，都必须要先办理ICP备案后才可以上线。**

### 1.2 有何作用

通过查询目标企业的备案信息，可直接获取到目标企业注册了哪些域名，从而增加可渗透的目标范围。

### 1.3 如何查询

> 推荐使用官方网站[ICP/IP地址/域名信息备案管理系统](https://beian.miit.gov.cn/#/Integrated/recordQuery)
>

支持使用`单位名称`、`域名`和`备案号`进行查询

![image-20220531092300206](信息收集.assets\image-20220531092300206.png)

#### 1.3.1 使用单位名称查询

![image-20220531092805660](信息收集.assets\image-20220531092805660.png)

#### 1.3.2 使用域名查询

![image-20220531092832898](信息收集.assets\image-20220531092832898.png)

#### 1.3.3 使用备案号查询

![image-20220531092934522](信息收集.assets\image-20220531092934522.png)

使用任意参数查询后，可通过相关的信息查询其他相关的域名达到收集目标域名的目的

![image-20220531093304758](信息收集.assets\image-20220531093304758.png)

### 1.4 第三方查询网站

> [ICP备案查询 - 站长工具](http://icp.chinaz.com/)
>
> [站长seo综合查询工具-爱站网](https://icp.aizhan.com/)



## 2.证书查询

### 2.1 什么是证书

SSL证书是一种遵守SSL协议的服务器数字证书，由受信任的根证书颁发机构颁发。 SSL证书采用SSL协议进行通信，SSL证书部署到服务器后，服务器端的访问将启用HTTPS协议。 您的网站将会通过HTTPS加密协议来传输数据，可帮助服务器端和客户端之间建立加密链接，从而保证数据传输的安全。

### 2.2 有何作用

通过查询共用SSL证书的网站，可以找到相关的其他域名。

### 2.3 如何查询

此处推荐3种方法

#### 2.3.1 浏览器直接查看

![image-20220531111726920](信息收集.assets\image-20220531111726920.png)

#### 2.3.2 通过在线网站

> 推荐使用 [crt.sh](https://crt.sh/)

输入域名即可查询

![image-20220531112050674](信息收集.assets\image-20220531112050674.png)

#### 2.3.3 通过网络空间搜索引擎

> 以Fofa为例，shodan和zoomeye类似

可查询fofa语法手册：

| 语法                              | 说明                                          |
| :-------------------------------- | :-------------------------------------------- |
| cert="baidu"                      | 搜索证书(https或者imaps等)中带有baidu的资产。 |
| cert.subject="Oracle Corporation" | 搜索证书持有者是Oracle Corporation的资产      |
| cert.issuer="DigiCert"            | 搜索证书颁发者为DigiCert Inc的资产            |
| cert.is_valid=true                | 验证证书是否有效，true有效，false无效         |

![image-20220531112613946](信息收集.assets\image-20220531112613946.png)

![image-20220531112735501](信息收集.assets\image-20220531112735501.png)



## 3.DNS共享记录查询

### 3.1 什么是DNS

DNS（Domain Name Server，域名服务器）是进行域名(domain name)和与之相对应的IP地址 (IP address)转换的服务器。DNS中保存了一张域名(domain name)和与之相对应的IP地址 (IP address)的表，以解析消息的域名。 域名是Internet上某一台计算机或计算机组的名称，用于在数据传输时标识计算机的电子方位（有时也指地理位置）。域名是由一串用点分隔的名字组成的，通常包含组织名，而且始终包括两到三个字母的后缀，以指明组织的类型或该域所在的国家或地区。

### 3.2 有何作用

此处通过查询共享DNS服务器的主机来获取到相关的域名；

需要注意的是，如果是公开的DNS服务器，那么查询的效果将会特别差；

通过ISP收集的DNS数据，获取目标DNS服务器的查询记录。

### 3.3 如何查询

首先查询目标是否存在自建的NS服务器

![image-20220531140932438](信息收集.assets\image-20220531140932438.png)

将获取到的NS服务器带入 https://hackertarget.com/find-shared-dns-servers/ 进行查询

![image-20220531113817815](信息收集.assets\image-20220531113817815.png)



## 4.WHOIS查询

### 4.1 什么是WHOIS

`WHOIS`是用来查询互联网中域名的IP以及所有者等信息的传输协议。早期的`WHOIS`查询多以命令行接口存在，但是现在出现了一些基于网页接口的简化在线查询工具，甚至可以一次向不同的数据库查询。网页接口的查询工具仍然依赖WHOIS协议向服务器发送查询请求，命令行接口的工具仍然被系统管理员广泛使用。

### 4.2 有何作用

通过查询目标的WHOIS信息，对联系人、联系邮箱等信息进行反查，获取更多相关的域名信息。

重点关注注册商、注册人、邮件、DNS解析服务器、注册人联系电话。

### 4.3 如何查询

#### 4.3.1 本地WHOIS查询



#### 4.3.2 在线查询网站

> [域名Whois查询 - 站长之家](http://whois.chinaz.com/)
>
> [站长工具whois查询工具爱站网](https://whois.aizhan.com/)
>
> [国家域名whois](https://whois.cnnic.cn/WelcomeServlet)
>
> [全球 WHOIS 查询](https://www.whois365.com/cn/)
>
> [域名信息查询 - 腾讯云](https://whois.cloud.tencent.com/)
>
> [whois查询-中国万网](https://whois.aliyun.com/)

此处以站长之家查询为例，输入域名即可进行查询

![image-20220531143906649](信息收集.assets\image-20220531143906649.png)

点击联系人后方的 **whois反查** 进行联系人反查

![image-20220531143933653](信息收集.assets\image-20220531143933653.png)

点击联系邮箱后方的 **whois反查** 进行邮箱反查

![image-20220531143955596](信息收集.assets\image-20220531143955596.png)



## 5.IP反查

### 5.1 有何作用

目标多个域名可能绑定在同一IP上，通过IP反查一定情况下可获取到其他的域名信息。

### 5.2 如何查询

> [同IP网站查询，同服务器网站查询 - 站长工具](http://s.tool.chinaz.com/same)
>
> [Online investigation tool - Reverse IP, NS, MX, WHOIS and Search Tools](https://dnslytics.com/)

输入相关的域名或IP地址即可查询

![image-20220531144553967](信息收集.assets\image-20220531144553967.png)



## 6.股权信息

通过查询股权信息，或者股权穿透图，寻找子公司和子子公司等，一般对外投资超过50%或者有行政权限的都可以算目标

查询网站：

> [天眼查](https://www.tianyancha.com/)
>
> [企查查](https://www.qcc.com/)

如查询字节跳动

![image-20220531145932483](信息收集.assets\image-20220531145932483.png)

通过查询子公司，再查询子公司对应的产品，可以大范围的扩大攻击面



## 7.SRC平台

一些在SRC上进行众测的厂商，会把自己的测试范围列举出来，其中就包含有大量的域名，因此通过SRC来完善资产收集也是一个不错的方法。

> [补天](https://www.butian.net/)
>
> [漏洞盒子](https://www.vulbox.com/)
>
> [HackerOne](https://hackerone.com/)

以HackerOne为例：

https://hackerone.com/alibaba?type=team&view_policy=true

![image-20220531161349905](信息收集.assets\image-20220531161349905.png)

![image-20220531150121662](信息收集.assets\image-20220531150121662.png)



## 8.搜索引擎

在搜索引擎中直接搜索里面的一些关键内容来查询，比如公司名、备案、引用的特殊js等

以阿里为例：

```
intext:浙ICP备09002987号 intext:33010002000070 -www
```

![image-20220531162130691](信息收集.assets\image-20220531162130691.png)